{% extends 'admin_panel/base_admin.html' %}
{% load static %}

{% block title %}Configurações de Aparência - Admin{% endblock %}
{% block page_title %}Configurações de Aparência{% endblock %}

{% block breadcrumb %}
<nav class="flex" aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
            <a href="{% url 'admin_panel:dashboard' %}" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <i class="fas fa-home mr-2"></i>
                Dashboard
            </a>
        </li>
        <li>
            <div class="flex items-center">
                <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                <span class="text-gray-500 dark:text-gray-400">Configurações</span>
            </div>
        </li>
        <li>
            <div class="flex items-center">
                <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                <span class="text-gray-500 dark:text-gray-400">Aparência</span>
            </div>
        </li>
    </ol>
</nav>
{% endblock %}

{% block dashboard_content %}
<div class="space-y-6">
    <!-- Configurações de Tema -->
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">
                <i class="fas fa-palette mr-2 text-gray-500"></i>
                Configurações de Tema
            </h3>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Tema Padrão -->
                <div>
                    <label for="default_theme" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Tema Padrão
                    </label>
                    <select name="default_theme" 
                            id="default_theme"
                            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="light" {% if default_theme == 'light' %}selected{% endif %}>Claro</option>
                        <option value="dark" {% if default_theme == 'dark' %}selected{% endif %}>Escuro</option>
                        <option value="auto" {% if default_theme == 'auto' %}selected{% endif %}>Automático (Sistema)</option>
                    </select>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Tema padrão aplicado para novos usuários.
                    </p>
                </div>
                
                <!-- Permitir Troca de Tema -->
                <div class="flex items-center">
                    <input type="checkbox" 
                           name="allow_theme_switching" 
                           id="allow_theme_switching"
                           {% if allow_theme_switching %}checked{% endif %}
                           class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="allow_theme_switching" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                        Permitir que usuários alterem o tema
                    </label>
                </div>
                
                <!-- Cor Primária -->
                <div>
                    <label for="primary_color" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Cor Primária
                    </label>
                    <div class="mt-1 flex items-center space-x-3">
                        <input type="color" 
                               name="primary_color" 
                               id="primary_color" 
                               value="{{ primary_color }}"
                               class="h-10 w-20 border border-gray-300 rounded-md cursor-pointer">
                        <input type="text" 
                               name="primary_color_hex" 
                               id="primary_color_hex" 
                               value="{{ primary_color }}"
                               placeholder="{{ primary_color }}"
                               class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Cor principal da interface do usuário.
                    </p>
                </div>
                
                <!-- Cor Secundária -->
                <div>
                    <label for="secondary_color" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Cor Secundária
                    </label>
                    <div class="mt-1 flex items-center space-x-3">
                        <input type="color" 
                               name="secondary_color" 
                               id="secondary_color" 
                               value="{{ secondary_color }}"
                               class="h-10 w-20 border border-gray-300 rounded-md cursor-pointer">
                        <input type="text" 
                               name="secondary_color_hex" 
                               id="secondary_color_hex" 
                               value="{{ secondary_color }}"
                               placeholder="{{ secondary_color }}"
                               class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Cor secundária para elementos de apoio.
                    </p>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-md text-sm font-medium transition-colors">
                        <i class="fas fa-save mr-2"></i>
                        Salvar Configurações
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Configurações de Logo e Branding -->
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">
                <i class="fas fa-image mr-2 text-gray-500"></i>
                Logo e Branding
            </h3>
            
            <form method="post" enctype="multipart/form-data" class="space-y-6">
                {% csrf_token %}
                
                <!-- Logo Principal -->
                <div>
                    <label for="main_logo" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Logo Principal
                    </label>
                    <div class="mt-1 flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <img class="h-16 w-16 object-contain bg-gray-100 dark:bg-gray-700 rounded-lg p-2" 
                                 src="{% static 'images/logo.png' %}" 
                                 alt="Logo atual">
                        </div>
                        <div class="flex-1">
                            <input type="file" 
                                   name="main_logo" 
                                   id="main_logo" 
                                   accept="image/*"
                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100">
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                Recomendado: PNG ou SVG, máximo 2MB, proporção 1:1.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Logo Escuro -->
                <div>
                    <label for="dark_logo" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Logo para Tema Escuro
                    </label>
                    <div class="mt-1 flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <img class="h-16 w-16 object-contain bg-gray-800 rounded-lg p-2" 
                                 src="{% static 'images/logo-dark.png' %}" 
                                 alt="Logo escuro atual">
                        </div>
                        <div class="flex-1">
                            <input type="file" 
                                   name="dark_logo" 
                                   id="dark_logo" 
                                   accept="image/*"
                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100">
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                Logo otimizado para tema escuro (opcional).
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Favicon -->
                <div>
                    <label for="favicon" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Favicon
                    </label>
                    <div class="mt-1 flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <img class="h-8 w-8 object-contain" 
                                 src="{% static 'images/favicon.ico' %}" 
                                 alt="Favicon atual">
                        </div>
                        <div class="flex-1">
                            <input type="file" 
                                   name="favicon" 
                                   id="favicon" 
                                   accept=".ico,.png"
                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100">
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                Formato ICO ou PNG, 32x32 pixels recomendado.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        <i class="fas fa-save mr-2"></i>
                        Salvar Configurações
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Configurações de Layout -->
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">
                <i class="fas fa-layout mr-2 text-gray-500"></i>
                Configurações de Layout
            </h3>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Sidebar Colapsada por Padrão -->
                <div class="flex items-center">
                    <input type="checkbox" 
                           name="sidebar_collapsed_default" 
                           id="sidebar_collapsed_default"
                           {% if sidebar_collapsed_default %}checked{% endif %}
                           class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="sidebar_collapsed_default" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                        Sidebar colapsada por padrão
                    </label>
                </div>
                
                <!-- Mostrar Breadcrumbs -->
                <div class="flex items-center">
                    <input type="checkbox" 
                           name="show_breadcrumbs" 
                           id="show_breadcrumbs"
                           {% if show_breadcrumbs %}checked{% endif %}
                           class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="show_breadcrumbs" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                        Mostrar breadcrumbs de navegação
                    </label>
                </div>
                
                <!-- Densidade da Interface -->
                <div>
                    <label for="ui_density" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Densidade da Interface
                    </label>
                    <select name="ui_density" 
                            id="ui_density"
                            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="compact" {% if ui_density == 'compact' %}selected{% endif %}>Compacta</option>
                        <option value="normal" {% if ui_density == 'normal' %}selected{% endif %}>Normal</option>
                        <option value="comfortable" {% if ui_density == 'comfortable' %}selected{% endif %}>Confortável</option>
                    </select>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Controla o espaçamento e tamanho dos elementos da interface.
                    </p>
                </div>
                
                <!-- Animações -->
                <div class="flex items-center">
                    <input type="checkbox" 
                           name="enable_animations" 
                           id="enable_animations"
                           {% if enable_animations %}checked{% endif %}
                           class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="enable_animations" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                        Habilitar animações da interface
                    </label>
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    Desabilitar pode melhorar a performance em dispositivos mais lentos.
                </p>
                
                <div class="flex justify-end">
                    <button type="submit" 
                            class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        <i class="fas fa-save mr-2"></i>
                        Salvar Configurações
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Preview das Configurações -->
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">
                <i class="fas fa-eye mr-2 text-gray-500"></i>
                Preview das Configurações
            </h3>
            
            <div class="space-y-4">
                <div class="p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg">
                    <div class="flex items-center space-x-4">
                        <div class="h-12 w-12 bg-primary-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-cog text-white text-xl"></i>
                        </div>
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white">Exemplo de Card</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Este é um exemplo de como as configurações afetam a aparência.</p>
                        </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="preview-primary-btn px-4 py-2 rounded-md text-sm transition-colors">
                            Botão Primário
                        </button>
                        <button class="preview-secondary-btn px-4 py-2 rounded-md text-sm transition-colors">
                            Botão Secundário
                        </button>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    As alterações de aparência serão aplicadas após salvar as configurações.
                </p>
            </div>
        </div>
    </div>
</div>

<style>
:root {
    --primary-color: {{ primary_color|default:'#2563eb' }};
    --secondary-color: {{ secondary_color|default:'#6b7280' }};
}

/* Aplicar cores dinâmicas aos botões e elementos */
.bg-primary-600, .btn-primary {
    background-color: var(--primary-color) !important;
}

.bg-primary-700, .btn-primary:hover {
    background-color: color-mix(in srgb, var(--primary-color) 85%, black) !important;
}

.text-primary-600 {
    color: var(--primary-color) !important;
}

.text-primary-700 {
    color: color-mix(in srgb, var(--primary-color) 85%, black) !important;
}

.border-primary-500, .focus\:border-primary-500:focus {
    border-color: var(--primary-color) !important;
}

.ring-primary-500, .focus\:ring-primary-500:focus {
    --tw-ring-color: var(--primary-color) !important;
}

.bg-primary-50 {
    background-color: color-mix(in srgb, var(--primary-color) 10%, white) !important;
}

.bg-primary-100 {
    background-color: color-mix(in srgb, var(--primary-color) 20%, white) !important;
}

/* Preview dos botões com cores atualizadas */
.preview-primary-btn {
    background-color: var(--primary-color);
    color: white;
}

.preview-primary-btn:hover {
    background-color: color-mix(in srgb, var(--primary-color) 85%, black);
}

.preview-secondary-btn {
    background-color: var(--secondary-color);
    color: white;
}

.preview-secondary-btn:hover {
    background-color: color-mix(in srgb, var(--secondary-color) 85%, black);
}
</style>

<script>
// Sincronizar color picker com input de texto e aplicar cores em tempo real
function updateColors() {
    const primaryColor = document.getElementById('primary_color').value;
    const secondaryColor = document.getElementById('secondary_color').value;
    
    document.documentElement.style.setProperty('--primary-color', primaryColor);
    document.documentElement.style.setProperty('--secondary-color', secondaryColor);
}

document.getElementById('primary_color').addEventListener('change', function() {
    document.getElementById('primary_color_hex').value = this.value;
    updateColors();
});

document.getElementById('primary_color_hex').addEventListener('input', function() {
    if (/^#[0-9A-F]{6}$/i.test(this.value)) {
        document.getElementById('primary_color').value = this.value;
        updateColors();
    }
});

document.getElementById('secondary_color').addEventListener('change', function() {
    document.getElementById('secondary_color_hex').value = this.value;
    updateColors();
});

document.getElementById('secondary_color_hex').addEventListener('input', function() {
    if (/^#[0-9A-F]{6}$/i.test(this.value)) {
        document.getElementById('secondary_color').value = this.value;
        updateColors();
    }
});

// Aplicar cores iniciais
document.addEventListener('DOMContentLoaded', updateColors);
</script>
{% endblock %}