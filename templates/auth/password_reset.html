{% extends 'auth/base_auth.html' %}
{% load static %}

{% block auth_title %}Recuperar Senha{% endblock %}
{% block form_title %}Esqueceu sua senha?{% endblock %}
{% block form_subtitle %}Não se preocupe, vamos ajudá-lo a recuperar o acesso{% endblock %}

{% block form_content %}

<form method="post" class="space-y-6" id="passwordResetForm">
    {% csrf_token %}
    
    <div class="text-center mb-6">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-primary-100 dark:bg-primary-900 mb-4">
            <i class="fas fa-key text-primary-600 dark:text-primary-400"></i>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400">
            Digite seu email abaixo e enviaremos um link para redefinir sua senha.
        </p>
    </div>

    <div>
        <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Email
        </label>
        <input 
            type="email" 
            id="email" 
            name="email" 
            required 
            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
            placeholder="seu@email.com"
            autocomplete="email"
            autofocus
        >
        <div id="email-feedback" class="mt-1 text-sm hidden"></div>
    </div>

    <button 
        type="submit" 
        id="submitBtn"
        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
    >
        <span class="flex items-center">
            <i class="fas fa-paper-plane mr-2"></i>
            Enviar Link de Recuperação
        </span>
    </button>
</form>

<!-- Additional Information -->
<div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
    <div class="flex">
        <div class="flex-shrink-0">
            <i class="fas fa-info-circle text-blue-400"></i>
        </div>
        <div class="ml-3">
            <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">
                Como funciona?
            </h3>
            <div class="mt-2 text-sm text-blue-700 dark:text-blue-300">
                <ul class="list-disc list-inside space-y-1">
                    <li>Você receberá um email com um link seguro</li>
                    <li>O link expira em 24 horas por segurança</li>
                    <li>Clique no link para criar uma nova senha</li>
                    <li>Faça login com sua nova senha</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Security Notice -->
<div class="mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
    <div class="flex">
        <div class="flex-shrink-0">
            <i class="fas fa-shield-alt text-yellow-400"></i>
        </div>
        <div class="ml-3">
            <h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">
                Dica de Segurança
            </h3>
            <div class="mt-2 text-sm text-yellow-700 dark:text-yellow-300">
                <p>
                    Se você não solicitou a recuperação de senha, pode ignorar este email com segurança. 
                    Sua conta permanecerá protegida.
                </p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block auth_footer %}
<div class="text-center space-y-4">
    <div class="text-sm text-gray-600 dark:text-gray-400">
        Lembrou da senha?
        <a href="{% url 'login' %}" class="font-medium text-primary-600 hover:text-primary-500 transition-colors">
            Voltar ao login
        </a>
    </div>
    
    <div class="text-sm text-gray-600 dark:text-gray-400">
        Não tem uma conta?
        <a href="{% url 'register' %}" class="font-medium text-primary-600 hover:text-primary-500 transition-colors">
            Cadastre-se
        </a>
    </div>
</div>
{% endblock %}

{% block hero_title %}Recupere seu acesso{% endblock %}
{% block hero_subtitle %}Estamos aqui para ajudá-lo a voltar rapidamente{% endblock %}

{% block hero_features %}
    <div class="flex items-center space-x-3">
        <i class="fas fa-check-circle text-green-300"></i>
        <span>Processo seguro e confiável</span>
    </div>
    <div class="flex items-center space-x-3">
        <i class="fas fa-check-circle text-green-300"></i>
        <span>Link válido por 24 horas</span>
    </div>
    <div class="flex items-center space-x-3">
        <i class="fas fa-check-circle text-green-300"></i>
        <span>Suporte disponível se precisar</span>
    </div>
    <div class="flex items-center space-x-3">
        <i class="fas fa-check-circle text-green-300"></i>
        <span>Seus dados estão protegidos</span>
    </div>
{% endblock %}

{% block testimonial %}
    <blockquote class="text-center">
        <p class="text-lg italic opacity-90 mb-4">
            "O processo de recuperação é muito simples e rápido. Voltei a acessar em minutos."
        </p>
        <footer class="text-sm opacity-75">
            — Carlos Santos, Usuário há 2 anos
        </footer>
    </blockquote>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    /* Form validation styles */
    .field-valid {
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    
    .field-invalid {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }
    
    /* Success state animation */
    .success-animation {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('passwordResetForm');
    const emailInput = document.getElementById('email');
    const submitBtn = document.getElementById('submitBtn');
    
    // Email validation
    emailInput.addEventListener('blur', function() {
        const email = this.value;
        const feedback = document.getElementById('email-feedback');
        
        if (email) {
            // Simple email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailRegex.test(email)) {
                this.classList.add('field-valid');
                this.classList.remove('field-invalid');
                feedback.className = 'mt-1 text-sm text-green-600 hidden';
            } else {
                this.classList.add('field-invalid');
                this.classList.remove('field-valid');
                feedback.textContent = 'Por favor, insira um email válido';
                feedback.className = 'mt-1 text-sm text-red-600';
            }
        }
    });
    
    // Real-time email validation
    emailInput.addEventListener('input', function() {
        const email = this.value;
        const feedback = document.getElementById('email-feedback');
        
        if (email.length > 0) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailRegex.test(email)) {
                this.classList.add('field-valid');
                this.classList.remove('field-invalid');
                feedback.className = 'mt-1 text-sm hidden';
                submitBtn.disabled = false;
            } else {
                this.classList.remove('field-valid');
                this.classList.add('field-invalid');
                submitBtn.disabled = true;
            }
        } else {
            this.classList.remove('field-valid', 'field-invalid');
            feedback.className = 'mt-1 text-sm hidden';
            submitBtn.disabled = false;
        }
    });
    
    // Form submission
    form.addEventListener('submit', function(e) {
        const email = emailInput.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (!emailRegex.test(email)) {
            e.preventDefault();
            emailInput.classList.add('field-invalid');
            document.getElementById('email-feedback').textContent = 'Por favor, insira um email válido';
            document.getElementById('email-feedback').className = 'mt-1 text-sm text-red-600';
            return;
        }
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';
        
        // Show success message after a delay (simulating email sending)
        setTimeout(function() {
            if (!form.querySelector('.alert')) {
                const successMessage = document.createElement('div');
                successMessage.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg success-animation';
                successMessage.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-green-400"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800 dark:text-green-200">
                                Email enviado com sucesso!
                            </h3>
                            <div class="mt-2 text-sm text-green-700 dark:text-green-300">
                                <p>Verifique sua caixa de entrada e spam. O link expira em 24 horas.</p>
                            </div>
                        </div>
                    </div>
                `;
                form.appendChild(successMessage);
                
                // Reset button after showing success
                setTimeout(function() {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Reenviar Link';
                }, 3000);
            }
        }, 1500);
    });
    
    // Auto-focus on email input
    emailInput.focus();
});
</script>
{% endblock %}